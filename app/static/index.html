<!DOCTYPE html>
<html lang="pt-BR">
<head>
	<meta charset="UTF-8">
	<title>Assitente IA APPCC</title>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
	<link rel="stylesheet" href="/static/css/styles.css">
</head>
<body class="container py-4">
<h2 class="mb-4">Consulta de Etapas e Perigos</h2>

<div class="mb-3">
	<label class="form-label" for="selectProduto">Selecione o produto:</label>
	<select class="form-select" id="selectProduto" onchange="atualizarProduto()">
		<option value="">-- Escolha um produto --</option>
	</select>
</div>

<div class="mb-4" id="consultaEtapaContainer" style="display:none;">
	<label class="form-label" for="inputEtapa">Digite a etapa:</label>
	<input class="form-control mb-2" id="inputEtapa" placeholder="Ex: Envase" type="text">
	<button class="btn btn-primary" onclick="consultarEtapa()">Consultar Etapas</button>
</div>

<div class="mb-4" id="selectContainer" style="display:none;">
	<label class="form-label" for="selectEtapas">Etapas similares encontradas:</label>
	<div class="input-group mb-2">
		<select class="form-select" id="selectEtapas"></select>
		<button class="btn btn-secondary" onclick="buscarEtapaSelecionada()" type="button">Continuar</button>
	</div>
	<button class="btn btn-success d-none" id="btnSalvarEtapa" onclick="salvarEtapa()">Salvar Etapa</button>
</div>

<div class="mt-4" id="tabelaPerigos"></div>

<div class="mb-4" id="btnAnaliseContainer" style="display:none;">
	<button class="btn btn-warning" onclick="iniciarAnalise()">Iniciar Análise de Perigos</button>
	<button class="btn btn-primary" onclick="" disabled>Cadastrar Perigo</button>
</div>

<div class="mt-4" id="abasContainer" style="display:none;">
	<ul class="nav nav-tabs" id="abasNav" role="tablist">
		<li class="nav-item" role="presentation">
			<button class="nav-link" data-bs-target="#tabpane-biologico" data-bs-toggle="tab" id="tab-biologico"
			        role="tab" type="button">Biológico
			</button>
		</li>
		<li class="nav-item" role="presentation">
			<button class="nav-link" data-bs-target="#tabpane-fisico" data-bs-toggle="tab" id="tab-fisico" role="tab"
			        type="button">Físico
			</button>
		</li>
		<li class="nav-item" role="presentation">
			<button class="nav-link" data-bs-target="#tabpane-quimico" data-bs-toggle="tab" id="tab-quimico"
			        role="tab" type="button">Químico
			</button>
		</li>
		<li class="nav-item" role="presentation">
			<button class="nav-link" data-bs-target="#tabpane-qualidade" data-bs-toggle="tab" id="tab-qualidade"
			        role="tab" type="button">Qualidade
			</button>
		</li>
		<li class="nav-item" role="presentation">
			<button class="nav-link" data-bs-target="#tabpane-alergenico" data-bs-toggle="tab" id="tab-alergenico"
			        role="tab" type="button">Alergênico
			</button>
		</li>
	</ul>
	
	<div class="tab-content border border-top-0 p-3" id="abasConteudo">
		<div aria-labelledby="tab-biologico" class="tab-pane fade" id="tabpane-biologico" role="tabpanel"></div>
		<div aria-labelledby="tab-fisico" class="tab-pane fade" id="tabpane-fisico" role="tabpanel"></div>
		<div aria-labelledby="tab-quimico" class="tab-pane fade" id="tabpane-quimico" role="tabpanel"></div>
		<div aria-labelledby="tab-qualidade" class="tab-pane fade" id="tabpane-qualidade" role="tabpanel"></div>
		<div aria-labelledby="tab-alergenico" class="tab-pane fade" id="tabpane-alergenico" role="tabpanel"></div>
	</div>
</div>
<!-- Modal Editar Perigo -->
<div aria-hidden="true" aria-labelledby="modalEditarPerigoLabel" class="modal fade" id="modalEditarPerigo"
     tabindex="-1">
	<div class="modal-dialog modal-lg modal-dialog-scrollable">
		<div class="modal-content">
			<form class="d-flex flex-column h-100" id="formEditarPerigo"
			      onsubmit="event.preventDefault(); salvarEdicaoPerigo();">
				<div class="modal-header bg-warning flex-shrink-0 py-2 px-3">
					<h5 class="modal-title mb-0" id="modalEditarPerigoLabel">Editar Perigo</h5>
					<button aria-label="Fechar" class="btn-close" data-bs-dismiss="modal" type="button"></button>
				</div>
				
				<div class="modal-body p-3 flex-grow-1 overflow-auto">
					<div class="container-fluid">
						<div class="row g-3">
							
							<input name="id" type="hidden">
							<input name="idx" type="hidden">
							<input name="arquivo" type="hidden">
							<input name="produto" type="hidden">
							
							<div class="col-12">
								<label class="form-label">Etapa do Processo</label>
								<input class="form-control bg-light" id="etapaAtualModal" name="etapa" readonly
								       type="text">
							</div>
							
							<div class="col-md-4">
								<label class="form-label">Tipo</label>
								<select class="form-select" name="tipo">
									<option>B</option>
									<option>F</option>
									<option>Q</option>
									<option>QUAL</option>
									<option>A</option>
								</select>
							</div>
							
							<div class="col-md-8">
								<label class="form-label">Perigo</label>
								<input class="form-control" name="perigo" type="text">
							</div>
							
							<div class="col-12">
								<label class="form-label">Justificativa</label>
								<textarea class="form-control" name="justificativa" rows="2"></textarea>
							</div>
							
							<div class="col-md-4">
								<label class="form-label">Probabilidade</label>
								<select class="form-select" name="probabilidade">
									<option>Desprezível</option>
									<option>Baixa</option>
									<option>Média</option>
									<option>Alta</option>
								</select>
							</div>
							
							<div class="col-md-4">
								<label class="form-label">Severidade</label>
								<select class="form-select" name="severidade">
									<option>Baixa</option>
									<option>Média</option>
									<option>Alta</option>
								</select>
							</div>
							
							<div class="col-md-4">
								<label class="form-label">Risco</label>
								<select class="form-select" name="risco">
									<option>Desprezível</option>
									<option>Baixa</option>
									<option>Média</option>
									<option>Alta</option>
								</select>
							</div>
							
							<div class="col-12">
								<label class="form-label">Medida de Controle</label>
								<textarea class="form-control" name="medida" rows="2"></textarea>
							</div>
							
							<div class="col-md-6">
								<label class="form-label">Perigo Significativo</label>
								<select class="form-select" name="perigo_significativo">
									<option></option>
									<option>SIM</option>
									<option>NÃO</option>
								</select>
							</div>
							
							<div class="col-md-6">
								<label class="form-label">Origem</label>
								<input class="form-control" name="origem" type="text">
							</div>
						
						</div>
					</div>
				</div>
				
				<div class="modal-footer flex-shrink-0 py-2 px-3">
					<button class="btn btn-success" type="submit">Salvar Alterações</button>
					<button class="btn btn-secondary" data-bs-dismiss="modal" type="button">Cancelar</button>
				</div>
			</form>
		</div>
	</div>
</div>

<!-- Modal Editar Questionário -->
<div aria-hidden="true" aria-labelledby="modalEditarQuestionarioLabel" class="modal fade" id="modalEditarQuestionario"
     tabindex="-1">
	<div class="modal-dialog modal-lg modal-dialog-scrollable">
		<div class="modal-content">
			<form class="d-flex flex-column h-100" id="formEditarQuestionario"
			      onsubmit="event.preventDefault(); salvarEdicaoQuestionario(this)">
				<div class="modal-header bg-primary text-white py-2 px-3 flex-shrink-0">
					<h5 class="modal-title">Editar Questionário (Formulário H)</h5>
					<button aria-label="Fechar" class="btn-close" data-bs-dismiss="modal" type="button"></button>
				</div>
				
				<div class="modal-body p-3 flex-grow-1 overflow-auto">
					<input name="id" type="hidden">
					<input name="produto" type="hidden">
					<input name="etapa" type="hidden">
					<input name="arquivo" type="hidden">
					
					<div class="form-group mt-2">
						<label>1. Existem medidas preventivas?</label>
						<select class="form-select" name="questao_1" onchange="questionarioModal(this)">
							<option value="">Selecione</option>
							<option value="Sim">Sim</option>
							<option value="Não">Não</option>
						</select>
					</div>
					
					<div class="form-group mt-2" data-q="q1a" style="display: none;">
						<label>1a. O controle desta fase é necessário à segurança?</label>
						<select class="form-select" name="questao_1a" onchange="questionarioModal(this)">
							<option value="">Selecione</option>
							<option value="Sim">Sim</option>
							<option value="Não">Não</option>
						</select>
					</div>
					
					<div class="form-group mt-2" data-q="q2" style="display: none;">
						<label>2. A fase foi desenvolvida para eliminar ou reduzir o perigo?</label>
						<select class="form-select" name="questao_2" onchange="questionarioModal(this)">
							<option value="">Selecione</option>
							<option value="Sim">Sim</option>
							<option value="Não">Não</option>
						</select>
					</div>
					
					<div class="form-group mt-2" data-q="q3" style="display: none;">
						<label>3. O perigo pode ocorrer em níveis inaceitáveis?</label>
						<select class="form-select" name="questao_3" onchange="questionarioModal(this)">
							<option value="">Selecione</option>
							<option value="Sim">Sim</option>
							<option value="Não">Não</option>
						</select>
					</div>
					
					<div class="form-group mt-2" data-q="q4" style="display: none;">
						<label>4. Existe etapa posterior que possa eliminar ou reduzir?</label>
						<select class="form-select" name="questao_4" onchange="questionarioModal(this)">
							<option value="">Selecione</option>
							<option value="Sim">Sim</option>
							<option value="Não">Não</option>
						</select>
					</div>
					
					<div class="form-group mt-2">
						<label>Resultado:</label>
						<input class="form-control" name="resultado" type="text">
					</div>
				</div>
				
				<div class="modal-footer py-2 px-3 flex-shrink-0">
					<button class="btn btn-primary" type="submit">Salvar Questionário</button>
					<button class="btn btn-secondary" data-bs-dismiss="modal" type="button">Cancelar</button>
				</div>
			</form>
		</div>
	</div>
</div>

<div aria-hidden="true" aria-labelledby="modalEditarResumoLabel" class="modal fade" id="modalEditarResumo"
     tabindex="-1">
    <div class="modal-dialog modal-lg modal-dialog-scrollable">
       <div class="modal-content">
          <form class="d-flex flex-column h-100" id="formEditarResumo"
                onsubmit="event.preventDefault(); salvarEdicaoResumo();">

             <div class="modal-header bg-success text-white py-2 px-3 flex-shrink-0">
                <h5 class="modal-title mb-0" id="modalEditarResumoLabel">Resumo do APPCC - Formulário I</h5>
                <button aria-label="Fechar" class="btn-close" data-bs-dismiss="modal" type="button"></button>
             </div>

             <div class="modal-body p-3 overflow-auto flex-grow-1">
                <div class="container-fluid">
                   <div class="mb-3">
                      <label class="form-label">Etapa</label>
                      <input class="form-control bg-light" name="etapa_visivel" readonly>
                   </div>
                   <div class="mb-3">
                      <label class="form-label">Perigo</label>
                      <input class="form-control bg-light" name="perigo" readonly>
                   </div>

                   <button type="button" class="btn btn-outline-secondary btn-sm mb-3" onclick="sugerirResumoEdicao()">Sugerir com IA</button>

                   <div class="row g-3">
                      <input name="id" type="hidden">
                      <input name="produto" type="hidden">
                      <input name="etapa" type="hidden">
                      <input name="arquivo" type="hidden">

                      <div class="col-12">
                         <label class="form-label">Limite Crítico</label>
                         <textarea class="form-control" name="limite_critico" rows="2"></textarea>
                      </div>

                      <div class="col-md-6">
                         <label class="form-label">Monitoramento - O quê?</label>
                         <input class="form-control" name="monitoramento_oque" type="text">
                      </div>
                      <div class="col-md-6">
                         <label class="form-label">Monitoramento - Como?</label>
                         <input class="form-control" name="monitoramento_como" type="text">
                      </div>
                      <div class="col-md-6">
                         <label class="form-label">Monitoramento - Quando?</label>
                         <input class="form-control" name="monitoramento_quando" type="text">
                      </div>
                      <div class="col-md-6">
                         <label class="form-label">Monitoramento - Quem?</label>
                         <input class="form-control" name="monitoramento_quem" type="text">
                      </div>

                      <div class="col-12">
                         <label class="form-label">Ação Corretiva</label>
                         <textarea class="form-control" name="acao_corretiva" rows="2"></textarea>
                      </div>

                      <div class="col-md-6">
                         <label class="form-label">Registro</label>
                         <input class="form-control" name="registro" type="text">
                      </div>
                      <div class="col-md-6">
                         <label class="form-label">Verificação</label>
                         <input class="form-control" name="verificacao" type="text">
                      </div>
                   </div>
                </div>
             </div>

             <div class="modal-footer py-2 px-3 flex-shrink-0">
                <button class="btn btn-success" onclick="salvarEdicaoResumo()" type="button">Salvar Resumo</button>
                <button class="btn btn-secondary" data-bs-dismiss="modal" type="button">Cancelar</button>
             </div>
          </form>
       </div>
    </div>
</div>


<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/blueimp-md5/2.19.0/js/md5.min.js"></script>
<script src="/static/js/script.js"></script>
</body>
</html>
